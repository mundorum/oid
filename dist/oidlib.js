!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.oidlib=t():e.oidlib=t()}(self,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Bus:()=>o,ButtonOid:()=>h,ConsoleOid:()=>a,Oid:()=>l,OidBase:()=>r,OidUI:()=>c,Primitive:()=>n,css:()=>i,html:()=>s});const s=(e,...t)=>String.raw({raw:e},...t),i=(e,...t)=>String.raw({raw:e},...t);class o{constructor(){this._listeners=[],this._providers={},this._connections={}}subscribe(e,t){if(null!=e){let s={};"string"==typeof e&&null!=t?s[e]=t:"object"==typeof e&&(s=e);const i=this._listeners.slice();for(const e in s)null!=s[e]&&(e.includes("+")||e.includes("#")?i.push({topic:e,regexp:o._convertRegExp(e),handler:s[e]}):i.push({topic:e,handler:s[e]}));this._listeners=i}}unsubscribe(e){if(null!=e){const t={};"string"==typeof e&&null!=handler?t[e]=handler:"object"==typeof e&&(t=e);const s=this._listeners.slice();for(const e in t)for(const i in this._listeners)if(this._listeners[i].topic===e&&this._listeners[i].handler===t[e]){s.splice(i,1);break}this._listeners=s}}async publish(e,t){let s=!1;const i=this._listeners;for(const o in i){if(i[o].regexp){const t=i[o].regexp.exec(e);null!=t&&t[0]===e&&(s=!0)}else i[o].topic===e&&(s=!0);s&&i[o].handler(e,t)}}static _convertRegExp(e){return new RegExp(e.replace(/\//g,"\\/").replace(/\+/g,"[^/]+").replace(/#/g,".+"))}}o.i=new o;class n extends HTMLElement{constructor(){super(),this._bus=o.i}_subscribe(e,t){return this._bus.subscribe(e,t)}_unsubscribe(e,t){this._bus.unsubscribe(e,t)}async _publish(e,t){await this._bus.publish(e,t)}}class r extends n{constructor(){super(),this._mapTopicNotice={},this._mapNoticeTopic={},this._receiveHandler={},this._convertNotice=this._convertNotice.bind(this),this.handleNotice=this.handleNotice.bind(this),this._buildReceiveHandlers(),this._buildEventDispatchers()}_buildReceiveHandlers(){const e=this.constructor.spec;if(null!=e&&null!=e.receive)if(Array.isArray(e.receive))for(const t of e.receive)this._receiveHandler[t]=this["handle"+t[0].toUpperCase()+t.slice(1)].bind(this);else for(const[t,s]of Object.entries(e.receive))this._receiveHandler[t]=this[s].bind(this)}_buildEventDispatchers(){const e=this.constructor.spec;if(e&&e.template){let t=1;const s=e.template.split(/@([^=]*)={{this\.([^}]*)}}/);if(s.length>1){this._eventDispatch=[];let i="";for(let e=0;e+2<s.length;e+=3)i+=s[e]+r.eventClass+t,this._eventDispatch.push([r.eventClass+t,s[e+1],s[e+2]]),t++;e.template=i+s[s.length-1]}console.log("=== template"),console.log(this.constructor.spec.template),console.log(this._eventDispatch)}}connectedCallback(){this.hasAttribute("publish")&&this._publishNoticeTopic(this.publish),this.hasAttribute("subscribe")&&this._subscribeTopicNotice(this.subscribe)}disconnectedCallback(){for(const e in this._mapTopicNotice)this._mapTopicNotice[e]!=e?this._unsubscribe(e,this._convertNotice):this._unsubscribe(e,this.handleNotice)}static get observedAttributes(){return["publish","subscribe"]}get publish(){return this.getAttribute("publish")}set publish(e){this.setAttribute("publish",e),this._publishNoticeTopic(e)}get subscribe(){return this.getAttribute("subscribe")}set subscribe(e){this.setAttribute("subscribe",e),this._subscribeTopicNotice(e)}_subscribeTopicNotice(e){const t=e.split(",");for(const e of t){const t=e.lastIndexOf(":");if(-1!=t){const s=e.substring(0,t);this._mapTopicNotice[s]=e.substring(t+1),this._subscribe(s,this._convertNotice)}else this._mapTopicNotice[e]=e,this._subscribe(e,this.handleNotice)}}_publishNoticeTopic(e){const t=e.split(",");for(const e of t){const t=e.lastIndexOf(":");-1!=t?this._mapNoticeTopic[e.substring(0,t)]=e.substring(t+1):this._mapNoticeTopic[e]=e}}_notify(e,t){null!=this._mapNoticeTopic[e]&&this._publish(this._mapNoticeTopic[e],t)}_convertNotice(e,t){this.handleNotice(this._mapTopicNotice[e],t)}handleNotice(e,t){null!=this._receiveHandler[e]&&this._receiveHandler[e](e,t)}}r.eventClass="oidevent_";class c extends r{connectedCallback(){super.connectedCallback(),this.render()}render(){this._presentation=null;const e=this.constructor.spec;if(e&&e.template){let t=((e.styles?`<style>${e.styles}</style>`:"")+e.template).replace(/{{this\.([^}]*)}}/g,((e,t)=>this[t]));if(!1===e.shadow?(this.innerHTML=t,this._presentation=this.querySelector("#oid-prs")||this):this._presentation=this._shadowHTML(t),this._eventDispatch){const t=!1===e.shadow?this:this.shadowRoot;console.log("=== presentation"),console.log(t);for(const[e,s,i]of this._eventDispatch)t.querySelector("["+e+"]").addEventListener(s,this[i].bind(this))}}}_shadowHTML(e){const t=document.createElement("template");t.innerHTML=e;const s=document.importNode(t.content,!0);return this.shadowRoot?this.shadowRoot.innerHTML="":this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(s),this.shadowRoot.querySelector("#oid-prs")||s}}class l{static component(e){let t=e.implementation;if(null==t){const s=!1===e.ui?r:c,i=e.element[0].toUpperCase()+e.element.slice(1).replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}));t=class extends s{},Object.defineProperty(t,"name",{value:i})}const s=[];if(e.properties){Object.defineProperty(t,"observedAttributes",{get:function(){return this.observed}});for(const i in e.properties){const o=e.properties[i];Object.defineProperty(t.prototype,i,null==t.prototype.render?{get:function(){return this["_"+i]},set:function(e){this["_"+i]=e}}:{get:function(){return this["_"+i]},set:function(e){this["_"+i]=e,this.render()}}),null!=o.attribute&&!1===o.attribute||s.push(o.attribute?o.attribute:i)}}t.prototype.attributeChangedCallback=function(e,t,s){this[e]=s},Object.assign(t,{spec:e,observed:s}),customElements.define(e.element,t)}}class h extends c{constructor(){super(),this._onClick=this._onClick.bind(this)}_onClick(){this._notify("click",{value:this.value||this.label})}_onMouseEnter(){this._notify("mouseenter",{value:this.value||this.label})}}l.component({id:"oid:button",element:"button-oid",properties:{label:{},value:{}},implementation:h,styles:i`
  .button {
    border: 1px solid lightgray;
    border-radius: 5px;
    margin: 5px;
    color: #1d1d1b;
    padding: 14px 25px;
    text-align: center;
    text-decoration: none;
    display: block;
    width: 50%;
  }
  .button:hover {
    color: black;
    font-weight: bold;
    cursor: pointer;
  }`,template:s`
  <span id="oid-prs" class="button"
    @click={{this._onClick}} @mouseenter={{this._onMouseEnter}}>
    {{this.label}}
  </span>`});class a extends c{handleDisplay(e,t){this._presentation&&t.value&&(this._presentation.value+=`${t.value}\n`)}}return l.component({id:"oid:console",element:"console-oid",properties:{label:{}},receive:["display"],implementation:a,styles:i`
  .console {
    width: 97%;
    font-family: "Courier New", monospace;
    font-size: 1em;
    background-color: lightgray
  }`,template:s`
  <textarea class="console" rows="10" id="oid-prs" readonly>
  </textarea>`}),t})()));