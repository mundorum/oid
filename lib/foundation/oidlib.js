(function(o,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(o=typeof globalThis<"u"?globalThis:o||self,h(o.oidlib={}))})(this,function(o){"use strict";var H=Object.defineProperty;var L=(o,h,b)=>h in o?H(o,h,{enumerable:!0,configurable:!0,writable:!0,value:b}):o[h]=b;var y=(o,h,b)=>L(o,typeof h!="symbol"?h+"":h,b);const h=(p,...t)=>String.raw({raw:p},...t),b=(p,...t)=>String.raw({raw:p},...t);class m{constructor(){this._listeners={},this._listenersRgx=[],this._providers={},this._pendingCnx={}}subscribe(t,e){if(t!=null){let s={};typeof t=="string"&&e!=null?s[t]=e:typeof t=="object"&&(s=t);const i=this._listenersRgx.slice(),n={...this._listeners};for(const l in s)s[l]!=null&&(l.includes("+")||l.includes("#")?i.push([m._convertRegExp(l),s[l],l]):(n[l]==null?n[l]=[]:n[l]=n[l].slice(),n[l].push(s[l])));this._listenersRgx=i,this._listeners=n}}unsubscribe(t){if(t!=null){const e={};typeof t=="string"&&handler!=null?e[t]=handler:typeof t=="object"&&(e=t);const s=this._listenersRgx.slice(),i={...this._listeners};for(const n in e)if(n.includes("+")||n.includes("#")){for(const l in s)if(s[l][1]===e[n]&&s[l][2]==n){s.splice(l,1);break}}else if(i[n]!=null){for(const l in i[n])if(i[n][l]===e[n]){i[n]=i[n].toSplice(l,1);break}}this._listenersRgx=s,this._listeners=i}}async publish(t,e){if(this._listeners[t]!=null)for(const i of this._listeners[t])i(t,e);const s=this._listenersRgx;for(const i of s){const n=i[0].exec(t);n!=null&&n[0]===t&&i[1](t,e)}}static _convertRegExp(t){return new RegExp(t.replace(/\//g,"\\/").replace(/\+/g,"[^/]+").replace(/#/g,".+"))}provide(t,e,s){let i=!1;if(e!=null&&t!=null&&s!=null){const n=t+"#"+e;if(this._providers[n]==null&&(i=!0,this._providers[n]=s,this._pendingCnx[n]!=null)){for(let l of this._pendingCnx[n])l.connectionReady(t,e,s);delete this._pendingCnx[n]}}return i}withhold(t,e){let s=!1;if(e!=null&&t!=null){const i=t+"#"+e;this._providers[i]&&(s=!0,delete this._providers[i])}return s}connect(t,e,s){if(e!=null&&t!=null&&s!=null){const i=t+"#"+e;this._providers[i]?s.connectionReady(t,e,this._providers[i]):this._pendingCnx[i]?this._pendingCnx[i].push(s):this._pendingCnx[i]=[s]}}async invoke(t,e,s,i){const n=t+"#"+e;return this._providers[n]!=null?await this._providers[n].handleInvoke(t,s,i):null}}m.i=new m;const w={id:"default",bus:m.i,stylesheets:"/lib/foundation/",stydefault:["stylesheets:oiddefault.css"],assets:"/assets/"};class u{constructor(t,e,s,i,n){this._id=t||null,this._bus=e||u.i.bus,this._stylesheets=s||u.i.stylesheets,this._stydefault=i||u.i.stydefault,this._assets=n||u.i.assets}static create(t,e,s,i,n){if(t!=null&&u._spheres[t]!=null)throw new Error(`Sphere with id ${t} already exists`);const l=new u(t,e,s,i,n);return t!=null&&(u._spheres[t]=l),l}static get(t){return t&&u._spheres[t]||null}get id(){return this._id}get bus(){return this._bus}set stylesheets(t){this._stylesheets=t}get stylesheets(){return this._stylesheets}set stydefault(t){this._stydefault=t}get stydefault(){return this._stydefault}set assets(t){this._assets=t}get assets(){return this._assets}}u._spheres={},u.i=u.create(w.id,w.bus,w.stylesheets,w.stydefault,w.assets);class v extends HTMLElement{connectedCallback(){if(this.hasAttribute("global"))this._sphere=u.i,this.hasAttribute("stylesheets")&&(u.i.stydefault=this.getAttribute("stylesheets")),this.hasAttribute("stydefault")&&(u.i.stydefault=this.getAttribute("stydefault")),this.hasAttribute("assets")&&(u.i.assets=this.getAttribute("assets"));else{const t=this.getAttribute("id");u.get(t)?this._sphere=u.get(t):this._sphere=u.create(this.getAttribute("id"),new m,this.getAttribute("stylesheets"),this.getAttribute("stydefault"),this.getAttribute("assets"))}}get id(){return this._sphere.id}get stylesheets(){return this._sphere.stylesheets}get stydefault(){return this._sphere.stydefault}get assets(){return this._sphere.assets}get sphere(){return this._sphere}}v.elementTag="oid-sphere",customElements.define(v.elementTag,v);class S extends HTMLElement{constructor(){super(),this._sphere=null}get _bus(){return this._sphere==null?null:this._sphere.bus}connectedCallback(){let t=this._findAggregator(v);t!=null?this._sphere=t.sphere:this._sphere=u.i}_findAggregator(t){let e=this.parentNode!=null?this.parentNode:this instanceof DocumentFragment?this.host:null;for(;e!=null&&!(e instanceof t);)e=e.parentNode!=null?e.parentNode:e instanceof DocumentFragment?e.host:null;return e}_subscribe(t,e){this._bus!=null&&this._bus.subscribe(t,e)}_unsubscribe(t,e){this._bus.unsubscribe(t,e)}async _publish(t,e){await this._bus.publish(t,e)}_provide(t,e,s){this._bus.provide(t,e,s)}_withhold(t,e){this._bus.withhold(t,e)}_connect(t,e,s){this._bus.connect(t,e,s)}async _invoke(t,e,s,i){return await this._bus.invoke(t,e,s,i)}}class x extends S{constructor(){super(),this._mapTopicNotice={},this._rgxTopicNotice=[],this._mapNoticeTopic={},this._receiveHandler={},this._provideHandler={},this._connected={},this._convertNotice=this._convertNotice.bind(this),this.handleNotice=this.handleNotice.bind(this)}async connectedCallback(){super.connectedCallback(),await this._initialize()}disconnectedCallback(){this._finalize()}async _initialize(){const t=this.constructor.spec;if(t&&(this._buildHandlers(this._receiveHandler,t.receive),this._buildProviders(),this._buildProvidersHandlers(),this._buildEventDispatchers(t.dispatcher)),t&&t.properties)for(const[e,s]of Object.entries(t.properties))s.default!=null&&!this.hasAttribute(e)&&(this[e]=s.default);this.hasAttribute("custom")&&(this._custom=await c.getCustom(t.id,this.getAttribute("custom"))),this.hasAttribute("publish")&&this._publishNoticeTopic(this.getAttribute("publish")),this.hasAttribute("subscribe")&&this._subscribeTopicNotice(this.getAttribute("subscribe")),this.hasAttribute("connect")&&this._connectInterface(this.getAttribute("connect"))}_buildProviders(){const t=this.constructor.spec;if(t.provide!=null&&this.id)for(const e in t.provide)this._provide(e,this.id,this)}_buildProvidersHandlers(){const t=this.constructor.spec;if(t.provide!=null)for(const e in t.provide)this._buildHandlers(this._provideHandler,t.provide[e].operations,e)}_removeProviders(){const t=this.constructor.spec;if(t.provide!=null&&this.id)for(const e in t.provide)this._withhold(e,this.id)}_buildHandlers(t,e,s){if(e!=null){const i=s==null?"":s+".";if(Array.isArray(e))for(const n of e)t[i+n]==null&&(t[i+n]=this["handle"+n[0].toUpperCase()+n.slice(1)].bind(this));else for(const[n,l]of Object.entries(e))if(t[i+n]==null){const a=typeof l=="string"?l:l.handler!=null?l.handler:"handle"+n[0].toUpperCase()+n.slice(1);t[i+n]=this[a].bind(this)}}}_buildEventDispatchers(t){if(t){this._dispatcher=[];for(const[e,s,i]of t)this._dispatcher.push([e,s,i.bind(this)])}}_finalize(){this._removeProviders();for(const t in this._mapTopicNotice)this._mapTopicNotice[t]!=t?this._unsubscribe(t,this._convertNotice):this._unsubscribe(t,this.handleNotice)}attributeChangedCallback(t,e,s){const i=t.replace(/-([a-z])/g,(n,l)=>l.toUpperCase());this[i]=s}static get observedAttributes(){return["id"]}get id(){return this._id}set id(t){this._id!=null&&this._bus!=null&&this._removeProviders(),this._id=t,this._bus!=null&&this._buildProviders()}get publish(){return this.getAttribute("publish")}get subscribe(){return this.getAttribute("subscribe")}get connect(){return this.getAttribute("connect")}handleGet(t,e){return e.property!=null?this[e.property]:null}handleSet(t,e){e.property!=null&&e.value!=null&&(this[e.property]=e.value)}_subscribeTopicNotice(t){const e=t.split(";");for(const s of e){const i=s.split("~");if(i.length>1){const n=i[0].trim();n.includes("+")||n.includes("#")?this._rgxTopicNotice.push([m._convertRegExp(n),i[1].trim(),n]):this._mapTopicNotice[n]=i[1].trim(),this._subscribe(n,this._convertNotice)}else{const n=s.trim();this._mapTopicNotice[n]=n,this._subscribe(n,this.handleNotice)}}}_publishNoticeTopic(t){const e=t.split(";");for(const s of e){const i=s.split("~");i.length>1?this._mapNoticeTopic[i[0].trim()]=i[1].trim():this._mapNoticeTopic[s.trim()]=s.trim()}}_connectInterface(t){let e=!0;const s=t.split(";");for(const i of s){const n=i.split("#");n.length>1?this._connect(n[0].trim(),n[1].trim(),this):e=!1}return e}_notify(t,e){this._mapNoticeTopic[t]!=null&&this._publish(this._mapNoticeTopic[t],e)}_convertNotice(t,e){if(this._mapTopicNotice[t]!=null)this.handleNotice(this._mapTopicNotice[t],e);else for(const[s,i]of this._rgxTopicNotice){const n=s.exec(t);if(n!=null&&n[0]===t){this.handleNotice(i,e);break}}}connectTo(t,e){e.id&&this._connect(t,e.id,this)}connectionReady(t,e,s){this._connected[t]==null&&(this._connected[t]=[]),this._connected[t].push(e)}async _invoke(t,e,s){const i=c.getInterface(t);if(this._connected[t]!=null)if(i.response!=null&&i.response===!0){const n=[];for(const l of this._connected[t])n.push(await this._bus.invoke(t,l,e,s));return i.cardinality&&i.cardinality[2]=="1"?n[0]:n}else for(const n of this._connected[t])return await this._bus.invoke(t,n,e,s)}handleNotice(t,e){this._receiveHandler[t]!=null&&this._receiveHandler[t](t,e)}handleInvoke(t,e,s){let i=null;return this._provideHandler[t+"."+e]!=null&&(i=this._provideHandler[t+"."+e](e,s)),i}_getCustomField(t){return this._custom==null||this._custom[t]==null?null:this._custom[t]}_callCustom(t,e){if(this._custom!=null&&this._custom[t]!=null)return this._custom[t](this,e)}}class k extends x{}class f extends k{async connectedCallback(){await super.connectedCallback(),this._stylesheets=this.constructor.spec.stylesheets.replace('href="default"','href="'+this._sphere.stydefault+'"').replace('href="stylesheets:','href="'+this._sphere.stylesheets),this.render()}render(){const t=this.constructor.spec;let e=t!=null?t.template:null;if(this.template){const s=this.template();if(s!=this._template){this._template=s;const i=c.prepareDispatchers(s,this.constructor);this._templatePre=i.template,this._buildEventDispatchers(i.dispatcher,this)}e=this._templatePre}if(this._presentation=null,t!=null&&e!=null){let s=this._getCustomField("style");s=s?`<style>${s}</style>`:"";const i=(this._stylesheets+t.styles+s+e).replace(/{{[ \t]*(url:)?[ \t]*this\.([^}]*)}}/g,(n,l,a)=>{a=a?a.trim():"";let d=this[a]?this[a]:"";return l==="url:"&&(d=d.replace("assets:",this._sphere.assets)),d});if(t.shadow===!1?(this.innerHTML=i,this._presentation=this.querySelector("#oid-prs")||this):this._presentation=this._shadowHTML(i),this._dispatcher){const n=t.shadow===!1?this:this.shadowRoot;for(const[l,a,d]of this._dispatcher)n.querySelector("["+l+"]").addEventListener(a,d)}}}_shadowHTML(t){const e=f.prepareShadow(this,t);return this.shadowRoot.querySelector("#oid-prs")||e}static prepareShadow(t,e){const s=document.createElement("template");s.innerHTML=e;const i=document.importNode(s.content,!0);return t.shadowRoot?t.shadowRoot.innerHTML="":t.attachShadow({mode:"open"}),t.shadowRoot.appendChild(i),i}}const r=class r{static cInterface(t){t!=null&&(r._interfaceReg[t.id]=t)}static getInterface(t){return r._interfaceReg[t]}static component(t){t=Object.assign({},r._defaultSpec,t);let e=t.implementation;if(e==null){const n=t.ui===!1||t.template==null?t.element==null?x:k:f,l=t.element[0].toUpperCase()+t.element.slice(1).replace(/-([a-z])/g,(a,d)=>d.toUpperCase());e=class extends n{},Object.defineProperty(e,"name",{value:l})}const s=e.observedAttributes.slice();if(t.properties){Object.defineProperty(e,"observedAttributes",{get:function(){return this.observed}});for(const n in t.properties){const l=t.properties[n],a=n.replace(/-([a-z])/g,(d,g)=>g.toUpperCase());Object.defineProperty(e.prototype,a,l.readonly?{get:function(){return this["_"+a]}}:e.prototype.render==null?{get:function(){return this["_"+a]},set:function(d){this["_"+a]=d}}:{get:function(){return this["_"+a]},set:function(d){const g=this["_"+a];this["_"+a]=d,g!=d&&this._sphere&&this.render()}}),(l.attribute==null||l.attribute!==!1)&&s.push(n)}}if(t.provide=t.provide==null?r.defaultInterface:t.provide.concat(r.defaultInterface),t.provide){const n={};for(const l of t.provide){const a=r._interfaceReg[l];if(a==null)throw new Error("Unknown interface id: "+l);n[l]=a}t.provide=n}r.stylePreprocess(t);const i=r.prepareDispatchers(t.template,e);t.template=i.template,i.dispatcher&&(t.dispatcher=i.dispatcher),Object.assign(e,{spec:t,observed:s}),t.element==null&&(t.element="internal-"+t.id.replace(":","-")),customElements.define(t.element,e),r._oidReg[t.id]=e}static componentSet(t,e){if(t!=null&&r._oidReg[t]!=null){const s=r._oidReg[t].spec;for(const i in e)s[i]=e[i];r.stylePreprocess(s)}}static stylePreprocess(t){let e="";if(t.stylesheets){let s=t.stylesheets;Array.isArray(s)||(s=[s]);for(const i of s)e+=`<link href="${i}" rel="stylesheet">`}t.stylesheets=e,t.styles=t.styles?`<style>${t.styles}</style>`:""}static prepareDispatchers(t,e){let s=null;if(t){let i=1;const n=t.split(/@([^= >]*)[ \t]*(?:=[ \t]*{{[ \t]*this\.([^}]*)[ \t]*}})?/);if(n.length>1){s=[];let l="";for(let a=0;a+2<n.length;a+=3){l+=n[a]+r.eventAttribute+i+" ";const d=n[a+1].trim(),g=n[a+2]!=null?n[a+2].trim():"_on"+d[0].toUpperCase()+d.substring(1);s.push([r.eventAttribute+i,d,e.prototype[g]]),i++}t=l+n[n.length-1]}}return{template:t,dispatcher:s}}static create(t,e){const s=r._oidReg[t];if(s==null)throw new Error("Unknown component id: "+t);const i=document.createElement(s.spec.element);if(e!=null)for(const n in e)i.setAttribute(n,e[n]);return i}static customize(t,e){t!=null&&r._oidReg[t]!=null&&e!=null&&e.cid!=null&&(r._oidCustom[t+"."+e.cid]=e,r._customQueue[t+"."+e.cid]!=null&&(r._customQueue[t+"."+e.cid](),delete r._customQueue[t+"."+e.cid]))}static async getCustom(t,e){return t==null||e==null?null:(r._oidCustom[t+"."+e]==null&&await new Promise((i,n)=>{const l=function(){i()};r._customQueue[t+"."+e]=l}),r._oidCustom[t+"."+e])}static setDefault(t){this._defaultSpec=t}static addDefault(t){for(const e in t)this._defaultSpec[e]==null?this._defaultSpec[e]=t[e]:Array.isArray(this._defaultSpec[e])?this._defaultSpec[e]=this._defaultSpec[e].concat(t[e]):typeof this._defaultSpec[e]=="object"?Object.assign(this._defaultSpec[e],t[e]):this._defaultSpec[e]=t[e]}};y(r,"eventAttribute","oidevent_"),y(r,"defaultInterface",["itf:oid"]),y(r,"_interfaceReg",{}),y(r,"_oidReg",{}),y(r,"_oidCustom",{}),y(r,"_customQueue",{}),y(r,"_defaultSpec",{});let c=r;c.cInterface({id:"itf:oid",operations:{get:{response:!0},set:{response:!1}},cardinality:"n:n"}),c.cInterface({id:"itf:transfer",operations:["send"],cardinality:"n:n"}),c.cInterface({id:"itf:iterate",operations:{first:{response:!0},next:{response:!0}},cardinality:"1:n"});class _ extends v{connectedCallback(){super.connectedCallback();const t=this._prepareHTML(),e=_.template.replace("{stylesheet}",this.stylesheet).replace("{code}",_.code.replace("{html}",t).replace("{rows}",this._rows(t))).replace("{console}",this.messages?_.console.replace("{rows}",this.rows?this.rows:_.rows):"");f.prepareShadow(this,e),this._scriptPanel=this.shadowRoot.querySelector("#script"),this._unlockScript=this._unlockScript.bind(this),this._scriptPanel.addEventListener("click",this._unlockScript),this._buttonRender=this.shadowRoot.querySelector("#btn-render"),this._buttonRender.addEventListener("click",this._computeRender.bind(this)),this._observer=new MutationObserver(this._scriptUpdated.bind(this)),this._observer.observe(this,{attributes:!0,childList:!0,subtree:!0}),this.sphere.bus.subscribe("#",this._busMonitor.bind(this))}static get observedAttributes(){return v.observedAttributes.concat(["messages","rows"])}get messages(){return this.hasAttribute("messages")}get messages(){return this.hasAttribute("messages")}get rows(){return this.getAttribute("rows")}set rows(t){this.setAttribute("rows",t)}_scriptUpdated(t,e){const s=this._prepareHTML();this._scriptPanel.value=s,this._scriptPanel.rows=this._rows(s)}_rows(t){const e=t.split(/\r\n|\r|\n/);let s=0;return e.forEach(i=>{s+=Math.floor(i.length/45)+1}),s}_prepareHTML(){let t=this.innerHTML.replace('=""',"").replace(/^[\r\n]+/,"").replace(/[\r\n]+$/,"");if(t.startsWith(" ")||t.startsWith("	")){const e=t.match(/^[ \t]+/);t=t.replace(new RegExp("^"+e,"gm"),"")}return t}_unlockScript(){this._scriptPanel.removeEventListener("click",this._unlockScript),this._scriptPanel.readOnly=!1,this._buttonRender.style.display="initial"}_computeRender(){this.shadowRoot.querySelector("#render").innerHTML=this._scriptPanel.value}_busMonitor(t,e){t!="bus/monitor"&&this.sphere.bus.publish("bus/monitor",{value:`[${t}] ${JSON.stringify(e)}`})}}_.rows=5,_.code=h`<div style="width:100%;display:flex">
<textarea id="script" class="code" style="width:100%;cursor:pointer" rows="{rows}" readonly>{html}</textarea>
<button id="btn-render" class="btn btn-secondary" style="width:auto;display:none">Render</button>
</div>`,_.template=h`<link rel="stylesheet" href="{stylesheet}">
{code}
<div id="render"><slot></slot></div>
{console}`,_.console=h`<div id="msg-pnl" style="width:100%">
  <b>Messages on the Bus</b><br>
  <console-oid rows="{rows}" class="code" prompt="" subscribe="bus/monitor~display"></console-oid>
</div>`,_.elementTag="oid-play",customElements.define(_.elementTag,_);class A extends f{_onDragover(t){this.pre&&(this._presentation.innerHTML=this.pre),t.preventDefault()}async _onDrop(t){t.preventDefault(),this.post&&(this._presentation.innerHTML=this.post);let e=null;if(t.dataTransfer.items)for(const i of t.dataTransfer.items)i.kind==="file"&&(e=i.getAsFile());else e=t.dataTransfer.files[0];const s=await e.text();this._notify("loaded",{value:s}),this._invoke("itf:transfer","send",{value:s})}}c.component({id:"oid:file",element:"file-oid",properties:{label:{default:"Drop Zone"},pre:{default:"Drop your file here"},post:{default:"File loaded"}},implementation:A,styles:b`
  #oid-prs {
    border: 5px solid;
  }`,template:h`
  <div id="oid-prs" @dragover @drop>{{this.label}}</div>`});class C extends f{_onClick(){this._notify("click",{value:this.label||this.source})}_onMouseenter(){this._notify("mouseenter",{value:this.label||this.source})}_onMouseleave(){this._notify("mouseleave",{value:this.label||this.source})}}c.component({id:"oid:image",element:"image-oid",properties:{source:{default:"assets:images/image.svg"},label:{}},implementation:C,stylesheets:"default",template:h`
  <image id="oid-prs" src="{{url:this.source}}" alt="{{this.label}}"
    @click @mouseenter @mouseleave>`});class R extends f{_onClick(){this._callCustom("click"),this._notify("click",{value:this.value||this.label}),this._invoke("itf:transfer","send",{value:this.value||this.label})}_onMouseenter(){this._notify("mouseenter",{value:this.value||this.label})}_onMouseleave(){this._notify("mouseleave",{value:this.value||this.label})}}c.component({id:"oid:button",element:"button-oid",properties:{label:{},value:{}},implementation:R,stylesheets:"default",template:h`
  <button id="oid-prs" class="btn btn-primary"
    @click @mouseenter @mouseleave>
    {{this.label}}
  </button>`});class T extends f{handleSend(t,e){this._presentation&&e&&e.value&&(this._presentation.value+=(this.prompt.length>0?`${this.prompt} `:"")+`${e.value}
`)}}c.component({id:"oid:console",element:"console-oid",properties:{prompt:{default:">"},rows:{default:10}},receive:{display:"handleSend"},provide:["itf:transfer"],implementation:T,styles:b`
  .console {
    width: 100%;
    font-family: "Courier New", monospace;
    font-size: 1em;
    background-color: lightgray
  }`,template:h`
  <textarea class="console" rows="{{this.rows}}" id="oid-prs" readonly></textarea>`});class N extends f{connectedCallback(){this._value=this.getAttribute("value")||!1,super.connectedCallback()}static get observedAttributes(){return f.observedAttributes.concat(["variable","value"])}get variable(){return this._variable}set variable(t){this._variable=t}get value(){return this._value}set value(t){this._value=t}}class z extends N{connectedCallback(){super.connectedCallback(),this.hasAttribute("value")&&(this.value=this.getAttribute("value")!=="off",this.render()),this._notify("initial",{value:this.value?this.on:this.off})}render(){super.render(),this._input=this._presentation.querySelector("#oid-input"),this._input.checked=this.value}handleInvert(t,e){this.value=!this.value,this.value?this._input.checked=!0:this._input.checked=!1,this._notifyState()}handleOn(){this.value=!0,this._input.checked=!0,this._notifyState()}handleOff(){this.value=!1,this._input.checked=!1,this._notifyState()}_onInput(){this._value=this._input.checked,this._notifyState()}_notifyState(){const t=this._value?this.on:this.off;this._notify("change",{value:t}),this._notify(t,{value:t})}}c.component({id:"oid:switch",element:"switch-oid",properties:{on:{default:"on"},off:{default:"off"}},receive:["invert","on","off"],implementation:z,styles:b`
  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
  }
  input:checked + .slider {
    background-color: #2196F3;
  }
  input:focus + .slider {
    box-shadow: 0 0 1px #2196F3;
  }
  input:checked + .slider:before {
    -webkit-transform: translateX(26px);
    -ms-transform: translateX(26px);
    transform: translateX(26px);
  }
  .slider.round {
    border-radius: 34px;
  }
  .slider.round:before {
    border-radius: 50%;
  }`,template:h`
  <label id="oid-prs" class="switch">
    <input id="oid-input" type="checkbox" @input>
    <span class="slider round"></span>
  </label>`});class M extends N{connectedCallback(){super.connectedCallback(),this.hasAttribute("value")||(this.value=Math.round((parseInt(""+this.min)+parseInt(""+this.max))/2),this.render()),this._notify("initial",{value:this.value})}render(){super.render(),this._input=this._presentation.querySelector("#oid-input"),this.hasAttribute("index")&&(this._index=this._presentation.querySelector("#index"),this._index.innerHTML=this.value)}_onInput(){this._value=this._input.value,this.hasAttribute("index")&&(this._index.innerHTML=this.value),this._notify("change",{value:this.value})}}c.component({id:"oid:slider",element:"slider-oid",properties:{min:{default:0},max:{default:100},index:{default:!1}},implementation:M,stylesheets:"default",template:h`
  <div id="oid-prs" style="width:100%; display:flex; flex-direction:row">
    <span id="index" style="flex:initial"></span>
    <input type="range" id="oid-input" min="{{this.min}}" max="{{this.max}}"
           value="{{this.value}}" style="flex:auto" @input>
  </div>`});class E extends f{constructor(){super(),this._x=0,this._y=0,this._sideASize=0,this._onMousemove=this._onMousemove.bind(this),this._onMouseup=this._onMouseup.bind(this)}async connectedCallback(){await super.connectedCallback(),this._horz=this.split!=="vertical",this._resizer=this.shadowRoot.getElementById("resizer"),this._sidea=this.shadowRoot.getElementById("sidea"),this._sideb=this.shadowRoot.getElementById("sideb"),this._horz?(this._resizer.style.cursor="ew-resize",this._resizer.style.height="100%",this._resizer.classList.add("divide-x"),this._sidea.style.width=this.proportion):(this._resizer.style.cursor="ns-resize",this._presentation.style.flexDirection="column",this._resizer.style.width="100%",this._resizer.classList.add("divide-y"),this._sidea.style.height=this.proportion)}_onMousedown(t){this._x=t.clientX,this._y=t.clientY,this._sideASize=this._horz?this._sidea.getBoundingClientRect().width:this._sidea.getBoundingClientRect().height,this.shadowRoot.addEventListener("mousemove",this._onMousemove),this.shadowRoot.addEventListener("mouseup",this._onMouseup)}_onMousemove(t){const e=t.clientX-this._x,s=t.clientY-this._y;if(this._horz){const i=(this._sideASize+e)*100/this._presentation.getBoundingClientRect().width;this._sidea.style.width=i+"%",this._resizer.style.cursor="col-resize",document.body.style.cursor="col-resize"}else{const i=(this._sideASize+s)*100/this._presentation.getBoundingClientRect().height;this._sidea.style.height=i+"%",this._resizer.style.cursor="row-resize",document.body.style.cursor="row-resize"}this._sidea.style.userSelect="none",this._sidea.style.pointerEvents="none",this._sideb.style.userSelect="none",this._sideb.style.pointerEvents="none"}_onMouseup(t){this.shadowRoot.removeEventListener("mousemove",this._onMousemove),this.shadowRoot.removeEventListener("mouseup",this._onMouseup),this._resizer.style.cursor=this._horz?"ew-resize":"ns-resize",document.body.style.removeProperty("cursor"),this._sidea.style.removeProperty("user-select"),this._sidea.style.removeProperty("pointer-events"),this._sideb.style.removeProperty("user-select"),this._sideb.style.removeProperty("pointer-events"),this._notify("resize",{awidth:this._sidea.style.width,aheight:this._sidea.style.height,bwidth:this._sideb.style.width,bheight:this._sideb.style.height})}}c.component({id:"oid:split-pane",element:"split-pane-oid",properties:{split:{default:"horizontal"},proportion:{default:"50%"}},implementation:E,stylesheets:"default",styles:b`
  .group {
    display: flex;
    width: 100%;
    height: 100%;
  }
  .pane-b {
    flex: 1;
  }`,template:h`
  <div id="oid-prs" class="group">
    <div class="bg-base" id="sidea"><slot name="side-a"></slot></div>
    <div class="divide" id="resizer" @mousedown></div>
    <div class="pane-b bg-base" id="sideb"><slot name="side-b"></slot></div>
  </div>`});class P extends f{async connectedCallback(){super.connectedCallback(),this._toInitial=this.initial,this._updateVisualState(),this._observer=new MutationObserver(this._updateVisualState.bind(this)),this._observer.observe(this,{childList:!0,subtree:!0})}_updateVisualState(){this._toInitial!=null&&(this._state=this.querySelector(`#${this._toInitial}`),this._state!=null&&(this._toInitial=null));const t=this.querySelectorAll("*");for(let e=0;e<t.length;e++){const s=t[e];this._state==null&&(this._state=s),s===this._state&&s.style.display!=null?s.style.removeProperty("display"):(s.style.display==null||s.style.display!=="none")&&(s.style.display="none")}}handleFirst(){this._state=this.firstElementChild,this._updateVisualState()}handleNext(){if(this._state!=null){let t=this._state.nextElementSibling;t==null&&(t=this.firstElementChild),this._state=t,this._updateVisualState()}}handlePrev(){if(this._state!=null){let t=this._state.previousElementSibling;t==null&&(t=this.lastElementChild),this._state=t,this._updateVisualState()}}handleLast(){this._state=this.lastElementChild,this._updateVisualState()}handleState(t,e){this._state=this.querySelector(`#${e.value}`),this._updateVisualState()}}c.component({id:"oid:state-pane",element:"state-pane-oid",properties:{initial:{}},receive:["first","next","prev","last","state"],implementation:P,stylesheets:"default"}),o.Bus=m,o.ButtonOid=R,o.ConsoleOid=T,o.FileOid=A,o.ImageOid=C,o.Oid=c,o.OidBase=x,o.OidPlay=_,o.OidSphere=v,o.OidUI=f,o.OidWeb=k,o.Primitive=S,o.SliderOid=M,o.Sphere=u,o.SplitPaneOid=E,o.StatePaneOid=P,o.SwitchOid=z,o.css=b,o.html=h,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
